version: '3.8'

services:
    #----------------------------------------------------------------
    # Application Services (Production Build - Simulation)
    # Using pre-baked images from scripts/docker/bake-local.sh
    #----------------------------------------------------------------
    api:
        image: kodus-ai-api:local
        pull_policy: never
        container_name: kodus_api_sim
        restart: unless-stopped
        env_file:
            - .env
        environment:
            - API_PG_DB_HOST=db_postgres
            - API_MG_DB_HOST=mongodb
            - NODE_ENV=production
            - COMPONENT_TYPE=api
        ports:
            - '3331:3001'
        networks:
            - kodus-backend-services

    worker:
        image: kodus-ai-worker:local
        pull_policy: never
        container_name: kodus_worker_sim
        restart: unless-stopped
        env_file:
            - .env
        environment:
            - API_PG_DB_HOST=db_postgres
            - API_MG_DB_HOST=mongodb
            - NODE_ENV=production
            - COMPONENT_TYPE=worker
        networks:
            - kodus-backend-services

    webhooks:
        image: kodus-ai-webhook:local
        pull_policy: never
        container_name: kodus_webhooks_sim
        restart: unless-stopped
        env_file:
            - .env
        environment:
            - API_PG_DB_HOST=db_postgres
            - API_MG_DB_HOST=mongodb
            - NODE_ENV=production
            - COMPONENT_TYPE=webhook
        ports:
            - '3333:3332'
        networks:
            - kodus-backend-services

networks:
    kodus-backend-services:
        external: true
